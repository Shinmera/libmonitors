cmake_minimum_required(VERSION 3.1)
project(libmonitors)
list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}")
set(CMAKE_BUILD_TYPE Release)

add_library(libmonitors SHARED)

include_directories(source)
target_sources(libmonitors PUBLIC "src/monitors.c")

if(UNIX AND NOT APPLE)
  target_sources(libmonitors PUBLIC "src/monitors-linux.c")
endif()

if(APPLE)
  find_library(CORE_FOUNDATION CoreFoundation)
  find_library(IOKit_LIBRARY IOKit)
  target_link_libraries(libmonitors ${IOKit_LIBRARY} ${CORE_FOUNDATION})
  target_sources(libmonitors PUBLIC "src/monitors-darwin.c")
endif()

if(WIN32)
  find_package(WindowsSDK REQUIRED)
  include_directories(${WINSDK_INCLUDE_DIRS})
  target_compile_options(libmonitors PRIVATE -D_MSC_VER=1500)
  target_link_libraries(libmonitors ${WINSDK_LIBRARY_DIRS})
  target_sources(libmonitors PUBLIC "src/monitors-windows.c")
endif()

install(TARGETS libmonitors DESTINATION /usr/lib)
